"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var THREE = require("../../utils/three.min.js");
var cameraConfig = {
    flag: true,
    frame: {
        data: new Uint8Array(288 * 352),
        width: 0,
        height: 0
    },
};
var camera, renderer, scene;
Page({
    data: {
        frameSize: "small"
    },
    onLoad: function () {
        this.frameSizeInit();
    },
    onReady: function () {
        var that = this;
        var frameCount = 0;
        this.webglInit();
        var listener = wx.createCameraContext().onCameraFrame(function (res) {
            if (cameraConfig.flag === false)
                return;
            cameraConfig.flag = false;
            cameraConfig.frame.data = new Uint8Array(res.data);
            that.handleFrame();
            console.log(frameCount++);
        });
        listener.start();
    },
    handleFrame: function () {
        var geometry = new THREE.PlaneGeometry(cameraConfig.frame.width, cameraConfig.frame.height);
        var texture = new THREE.DataTexture(cameraConfig.frame.data, cameraConfig.frame.width, cameraConfig.frame.height, THREE.RGBAFormat);
        var tex_material = new THREE.MeshPhongMaterial({
            map: texture,
            side: THREE.DoubleSide
        });
        geometry.translate(cameraConfig.frame.width / 2, cameraConfig.frame.height / 2, 0);
        geometry.rotateX(Math.PI);
        var mesh = new THREE.Mesh(geometry, tex_material);
        scene.add(mesh);
        renderer.render(scene, camera);
        cameraConfig.flag = true;
    },
    webglInit: function () {
        wx.createSelectorQuery().select('#canvasId')
            .node()
            .exec(function (res) {
            var webcanvas = res[0].node;
            var k = cameraConfig.frame.width / cameraConfig.frame.height;
            var s = cameraConfig.frame.height / 2;
            camera = new THREE.OrthographicCamera(-s * k, s * k, s, -s, 1, 155);
            var x = cameraConfig.frame.width / 2;
            var y = -1 * cameraConfig.frame.height / 2;
            camera.position.set(x, y, 150);
            camera.lookAt(x, y, 0);
            renderer = new THREE.WebGLRenderer({
                canvas: webcanvas,
            });
            scene = new THREE.Scene();
            var light = new THREE.DirectionalLight('#ffffff', 3);
            light.position.set(cameraConfig.frame.width / 2, -1 * cameraConfig.frame.height / 2, 20);
            scene.add(light);
        });
    },
    frameSizeInit: function () {
        if (this.data.frameSize === "small") {
            cameraConfig.frame.width = 288;
            cameraConfig.frame.height = 352;
        }
        else if (this.data.frameSize === "medium") {
            cameraConfig.frame.width = 480;
            cameraConfig.frame.height = 640;
        }
        else if (this.data.frameSize === "large") {
            cameraConfig.frame.width = 720;
            cameraConfig.frame.height = 1280;
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGdEQUFrRDtBQUdsRCxJQUFJLFlBQVksR0FBRztJQUNqQixJQUFJLEVBQUUsSUFBSTtJQUNWLEtBQUssRUFBRTtRQUNMLElBQUksRUFBRSxJQUFJLFVBQVUsQ0FBQyxHQUFHLEdBQUMsR0FBRyxDQUFDO1FBQzdCLEtBQUssRUFBRSxDQUFDO1FBQ1IsTUFBTSxFQUFFLENBQUM7S0FDVjtDQUNGLENBQUM7QUFDRixJQUFJLE1BQVcsRUFBRSxRQUFhLEVBQUUsS0FBVSxDQUFDO0FBQzNDLElBQUksQ0FBQztJQUNILElBQUksRUFBRTtRQUNKLFNBQVMsRUFBRSxPQUFPO0tBQ25CO0lBQ0QsTUFBTTtRQUNKLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDO0lBQ0QsT0FBTztRQUNMLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztRQUNoQixJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUM7UUFDbkIsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2pCLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLGFBQWEsQ0FBQyxVQUFDLEdBQUc7WUFDeEQsSUFBRyxZQUFZLENBQUMsSUFBSSxLQUFLLEtBQUs7Z0JBQzVCLE9BQU87WUFDVCxZQUFZLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQztZQUMxQixZQUFZLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxJQUFJLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbkQsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ25CLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQztRQUM1QixDQUFDLENBQUMsQ0FBQTtRQUNGLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNuQixDQUFDO0lBRUQsV0FBVztRQUNU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RSxDQUFDLENBQUE7WUFDcEYsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFDQyxhQUFhO1FBQ1gsSUFBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsS0FBSyxPQUFPLEVBQUM7WUFDakMsWUFBWSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO1lBQy9CLFlBQVksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQztTQUNqQzthQUFNLElBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEtBQUssUUFBUSxFQUFDO1lBQ3pDLFlBQVksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQztZQUMvQixZQUFZLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUM7U0FDakM7YUFBTSxJQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxLQUFLLE9BQU8sRUFBQztZQUN4QyxZQUFZLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUM7WUFDL0IsWUFBWSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1NBQ2xDO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFRIUkVFIGZyb20gXCIuLi8uLi91dGlscy90aHJlZS5taW4uanNcIjtcbi8vIC8v6I635Y+W5bqU55So5a6e5L6LYXBwXG4vLyBjb25zdCBhcHAgPSBnZXRBcHA8SUFwcE9wdGlvbj4oKVxubGV0IGNhbWVyYUNvbmZpZyA9IHtcbiAgZmxhZzogdHJ1ZSwgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+aYr+WQpuiOt+WPluS4i+S4gOS4quWunuaXtuW4pyBcbiAgZnJhbWU6IHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+WunuaXtuW4p+aVsOaNrlxuICAgIGRhdGE6IG5ldyBVaW50OEFycmF5KDI4OCozNTIpLFxuICAgIHdpZHRoOiAwLFxuICAgIGhlaWdodDogMFxuICB9LCAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbn07XG5sZXQgY2FtZXJhOiBhbnksIHJlbmRlcmVyOiBhbnksIHNjZW5lOiBhbnk7ICAgLy90aHJlZS5qc+ebuOWFs+eahOS4ieWkp+imgee0oFxuUGFnZSh7XG4gIGRhdGE6IHtcbiAgICBmcmFtZVNpemU6IFwic21hbGxcIlxuICB9LFxuICBvbkxvYWQoKSB7XG4gICAgdGhpcy5mcmFtZVNpemVJbml0KCk7ICAgIC8v6Ieq5Yqo6YCC6YWN5a6e5pe25bin55qE5a696auYXG4gIH0sXG4gIG9uUmVhZHkoKSB7XG4gICAgbGV0IHRoYXQgPSB0aGlzO1xuICAgIGxldCBmcmFtZUNvdW50ID0gMDtcbiAgICB0aGlzLndlYmdsSW5pdCgpOyAgICAgICAgICAgICAgICAgIC8vd2ViZ2zliJ3lp4vljJZcbiAgICBsZXQgbGlzdGVuZXIgPSB3eC5jcmVhdGVDYW1lcmFDb250ZXh0KCkub25DYW1lcmFGcmFtZSgocmVzKSA9PiB7XG4gICAgICBpZihjYW1lcmFDb25maWcuZmxhZyA9PT0gZmFsc2UpIFxuICAgICAgICByZXR1cm47XG4gICAgICBjYW1lcmFDb25maWcuZmxhZyA9IGZhbHNlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/nq4vljbPlgZzmraLkuIvkuIDluKfnmoTojrflj5bvvIznrYnlvoXlvZPliY3luKflpITnkIblkI7vvIzlho3lpITnkIbkuIvkuIDluKdcbiAgICAgIGNhbWVyYUNvbmZpZy5mcmFtZS5kYXRhID0gbmV3IFVpbnQ4QXJyYXkocmVzLmRhdGEpOyAgICAvL+abtOaWsOWunuaXtuW4p+eahOWbvuWDj+aVsOaNrlxuICAgICAgdGhhdC5oYW5kbGVGcmFtZSgpO1xuICAgICAgY29uc29sZS5sb2coZnJhbWVDb3VudCsrKTtcbiAgICB9KVxuICAgIGxpc3RlbmVyLnN0YXJ0KCk7XG4gIH0sXG4gIC8v5LqL5Lu25aSE55CG5Ye95pWwXG4gIGhhbmRsZUZyYW1lKCkge1xuICAgIGxldCBnZW9tZXRyeSA9IG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KGNhbWVyYUNvbmZpZy5mcmFtZS53aWR0aCwgY2FtZXJhQ29uZmlnLmZyYW1lLmhlaWdodCk7IC8v55+p5b2i5bmz6Z2iXG4gICAgbGV0IHRleHR1cmUgPSBuZXcgVEhSRUUuRGF0YVRleHR1cmUoY2FtZXJhQ29uZmlnLmZyYW1lLmRhdGEsIGNhbWVyYUNvbmZpZy5mcmFtZS53aWR0aCwgY2FtZXJhQ29uZmlnLmZyYW1lLmhlaWdodCwgVEhSRUUuUkdCQUZvcm1hdCk7XG5cbiAgICAgIC8vdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7IC8v57q555CG5pu05paw77yM5L2c55So5a2Y55aR77yM5Ly85LmO5piv5q2j5L2c55SoXG4gICAgICBsZXQgdGV4X21hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKHtcbiAgICAgICAgbWFwOiB0ZXh0dXJlLCAgICAgICAgIC8vIOiuvue9rue6ueeQhui0tOWbvlxuICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlXG4gICAgICB9KTtcbiAgICAgIGdlb21ldHJ5LnRyYW5zbGF0ZShjYW1lcmFDb25maWcuZnJhbWUud2lkdGgvMiwgY2FtZXJhQ29uZmlnLmZyYW1lLmhlaWdodC8yLCAwKTtcbiAgICAgIGdlb21ldHJ5LnJvdGF0ZVgoTWF0aC5QSSlcbiAgICAgIGxldCBtZXNoID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIHRleF9tYXRlcmlhbCk7XG4gICAgICBzY2VuZS5hZGQobWVzaClcbiAgICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgY2FtZXJhKTtcbiAgICAgIGNhbWVyYUNvbmZpZy5mbGFnID0gdHJ1ZTtcbiAgfSxcbiAgd2ViZ2xJbml0KCkge1xuICAgIHd4LmNyZWF0ZVNlbGVjdG9yUXVlcnkoKS5zZWxlY3QoJyNjYW52YXNJZCcpXG4gICAgLm5vZGUoKVxuICAgIC5leGVjKChyZXMpID0+IHtcbiAgICAgIGxldCB3ZWJjYW52YXMgPSByZXNbMF0ubm9kZTtcbiAgICAgIGxldCBrID0gY2FtZXJhQ29uZmlnLmZyYW1lLndpZHRoIC8gY2FtZXJhQ29uZmlnLmZyYW1lLmhlaWdodDtcbiAgICAgIGxldCBzID0gY2FtZXJhQ29uZmlnLmZyYW1lLmhlaWdodC8yO1xuICAgICAgY2FtZXJhID0gbmV3IFRIUkVFLk9ydGhvZ3JhcGhpY0NhbWVyYSgtcyAqIGssIHMgKiBrLCBzLCAtcywgMSwgMTU1KTtcbiAgICAgIHZhciB4ID0gY2FtZXJhQ29uZmlnLmZyYW1lLndpZHRoLzI7XG4gICAgICB2YXIgeSA9IC0xICogY2FtZXJhQ29uZmlnLmZyYW1lLmhlaWdodC8yO1xuICAgICAgICAvL+S9v2NhbWVyYeato+WvueS4reW/g1xuICAgICAgICBjYW1lcmEucG9zaXRpb24uc2V0KHgsIHksIDE1MCk7XG4gICAgICAgIGNhbWVyYS5sb29rQXQoeCwgeSwgMCk7XG5cbiAgICAgICAgcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcih7XG4gICAgICAgICAgY2FudmFzOiB3ZWJjYW52YXMsXG4gICAgICAgICAgLy8gYW50aWFsaWFzOiB0cnVlLC8v5Y+N6ZSv6b2/XG4gICAgICAgICAgLy8gYWxwaGE6IHRydWUvL+mAj+aYjlxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgc2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTtcblxuICAgIC8v566A5piT5aKe55m956Oo55quXG4gICAgY29uc3QgbGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgnI2ZmZmZmZicsMylcbiAgICBsaWdodC5wb3NpdGlvbi5zZXQoY2FtZXJhQ29uZmlnLmZyYW1lLndpZHRoLzIsIC0xICogY2FtZXJhQ29uZmlnLmZyYW1lLmhlaWdodC8yLCAyMCkvL+WFieaWueWQkVxuICAgIHNjZW5lLmFkZChsaWdodCk7XG4gIH0pO1xufSxcbiAgZnJhbWVTaXplSW5pdCgpIHtcbiAgICBpZih0aGlzLmRhdGEuZnJhbWVTaXplID09PSBcInNtYWxsXCIpe1xuICAgICAgY2FtZXJhQ29uZmlnLmZyYW1lLndpZHRoID0gMjg4O1xuICAgICAgY2FtZXJhQ29uZmlnLmZyYW1lLmhlaWdodCA9IDM1MjtcbiAgICB9IGVsc2UgaWYodGhpcy5kYXRhLmZyYW1lU2l6ZSA9PT0gXCJtZWRpdW1cIil7XG4gICAgICBjYW1lcmFDb25maWcuZnJhbWUud2lkdGggPSA0ODA7XG4gICAgICBjYW1lcmFDb25maWcuZnJhbWUuaGVpZ2h0ID0gNjQwO1xuICAgIH0gZWxzZSBpZih0aGlzLmRhdGEuZnJhbWVTaXplID09PSBcImxhcmdlXCIpe1xuICAgICAgY2FtZXJhQ29uZmlnLmZyYW1lLndpZHRoID0gNzIwO1xuICAgICAgY2FtZXJhQ29uZmlnLmZyYW1lLmhlaWdodCA9IDEyODA7XG4gICAgfVxuICB9XG59KVxuIl19